{{define "index"}}<!doctype html>
<html lang="en">
<head>
  <link rel="stylesheet" href="./static/font/Font-Awesome/css/font-awesome.min.css">
  <link rel="stylesheet" href="https://openlayers.org/en/v4.1.1/css/ol.css" type="text/css">
  <style>
    .map {
      height: 100%;
      width: 100%;
    }

    div.tooltip {
      position: absolute;
      text-align: center;
      width: 160px;
      height: 28px;
      padding: 2px;
      font: 12px sans-serif;
      background: lightsteelblue;
      border: 0px;
      border-radius: 8px;
      pointer-events: none;
    }
  </style>
  <script src="https://d3js.org/d3.v4.min.js"></script>
  <script src="https://openlayers.org/en/v4.1.1/build/ol.js" type="text/javascript"></script>
  <title>OpenLayers example</title>
</head>
<body>
<div id="d3"></div>
<div id="map" class="map"></div>
<script type="text/javascript">
  var map = new ol.Map({
    target: 'map',
    layers: [
      new ol.layer.Tile({
        source: new ol.source.OSM()
      })
    ],
    view: new ol.View({
      center: ol.proj.fromLonLat([37.41, 8.82]),
      zoom: 4
    })
  });


  var data = [
    {percentual: 33, icon: '\uf2c8', status: "temperatura", background: "#ff0000", color: "#FFFFFF", size: 40, dx:   0, dy:   0},
    {percentual: 33, icon: '\uf2a3', status: "mãos", background: "#00ff00", color: "#FFFFFF", size: 40, dx: -20, dy: -20},
    {percentual: 33, icon: '\uf243', status: "bateria", background: "#0000ff", color: "#FFFFFF", size: 40, dx: -30, dy:   0}
  ];

  var w = 400,
    h = 400,
    r = Math.min(w, h) / 2,
    donut = d3.pie()
    .startAngle(-0 * (Math.PI/180))
    .endAngle(360 * (Math.PI/180));

  var arc = d3.arc()
  .innerRadius(r * .5)
  .outerRadius(r);

  // parse the date / time
  var div = d3.select("body").append("div")
  .attr("class", "tooltip")
  .style("opacity", 0);

  var vis = d3.select("body")
  .append("svg:svg")
  .data([data])
  .attr("width", w + 150)
  .attr("height", h);

  var arcs = vis.selectAll("g.arc")
  .data(donut.value(function (d) {
    return d.percentual;
  }))
  .enter().append("svg:g")
  .attr("class", "arc")
  .attr("transform", "translate(" + r + "," + r + ")")
  .on("mousemove", function(d) {
    div.transition()
    .duration(100)
    .style("opacity", .9);
    div.html(d.data.status)
    .style("left", (d3.event.pageX) + "px")
    .style("top", (d3.event.pageY - 28) + "px");
  })
  .on("mouseout", function(d) {
    div.transition()
    .duration(500)
    .style("opacity", 0);
  });

  arcs.append("svg:path")
  .attr("fill", function (d, i) {
    return d.data.background;
  })
  .attr("d", arc);

  var centroidX, centroidY;


  arcs.append("svg:foreignObject")
  .attr("font-family", "FontAwesome")
  .attr('font-size', function(d) { return ( d.data.size ) + 'px'} )
  .attr('color', function(d) { return d.data.color } )
  .attr("transform", function (d) {
    var textWidth = getTextWidth(d.data.icon, "FontAwesome");
    centroidX = arc.centroid(d)[0];
    centroidY = arc.centroid(d)[1];
    return "translate(" + (arc.centroid(d)[0] - textWidth/2 + d.data.dx) + "," + (arc.centroid(d)[1] - textWidth/2 + d.data.dy) + ")";
  })
  //.attr("dy", ".35em")
  .attr("text-anchor", function (d) {
    // are we past the center?
    return (d.endAngle + d.startAngle) / 2 > Math.PI ?
      "end" : "start";
  })
  .text(function (d) {
    return d.data.icon;
  })
  .attr('pointer-events', 'none' );


  vis.append("circle")
  .attr("cx", function(d) { return w/2; })
  .attr("cy", function(d) { return h/2; })
  .attr("r", r*.5)
  .style("fill", function(d, i) { return "#bbbbbb"; })
  .on("mousemove", function(d) {
    div.transition()
    .duration(100)
    .style("opacity", .9);
    div.html("Olá mundo!")
    .style("left", (d3.event.pageX) + "px")
    .style("top", (d3.event.pageY - 28) + "px");
  })
  .on("mouseout", function(d) {
    div.transition()
    .duration(500)
    .style("opacity", 0);
  });
  vis.append("svg:foreignObject")
  .attr("font-family", "FontAwesome")
  .attr('font-size', function(d) { return ( 80 ) + 'px'} )
  .attr('pointer-events', 'none' )
  .attr('color', function(d) { return "#000000" } )
  .attr("x", function( d ){
    return w / 2 + -40;
  } )
  .attr("y", function( d ){
    return h / 2 + -40;
  } )
  //.attr("dy", ".35em")
  .text( '\uf21c' );

  function getTextWidth(text, font) {
    var canvas = getTextWidth.canvas || (getTextWidth.canvas = document.createElement("canvas"));
    var context = canvas.getContext("2d");
    context.font = font;
    var metrics = context.measureText(text);
    return metrics.width;
  }


</script>
</body>
</html>{{end}}